import{h as _,u as $,q as I,r as x,j as e,i as P,s as k,t as C,S as F,F as q}from"./index-DQRB4LQk.js";function T(){const{theme:t}=_(),u=$(),m=I(),[d,y]=x.useState([]),[S,f]=x.useState(!1),[j,h]=x.useState(null),[r,b]=x.useState(null),N=new URLSearchParams(m.search),a=N.get("q")||"",l=N.get("category")||"all";console.log("SearchResultPage loaded"),console.log("Query:",a),console.log("Category:",l);const v=async(n,o)=>{if(!n){h("No search query provided");return}f(!0),h(null);try{console.log("Calling API for:",n,"Category:",o,"(unlimited results)");const c=await fetch(`http://localhost:8000/api/search?q=${encodeURIComponent(n)}&category=${o}`);if(!c.ok)throw new Error(`HTTP error! status: ${c.status}`);const i=await c.json();if(console.log("API Response:",i),i.results&&Array.isArray(i.results)){const g=i.results.map(s=>((!s.all_images||!Array.isArray(s.all_images))&&(s.all_images=[]),(!s.image_url||s.image_url==="null"||s.image_url.trim()==="")&&(s.image_url=null),s));y(g),b({query:n,category:o,count:i.count,unlimited:i.unlimited||!1}),console.log("Set results:",g.length,"items (unlimited)");const p=g.filter(s=>(!s.all_images||s.all_images.length===0)&&(!s.image_url||s.image_url===null));console.log(`Items needing AI images: ${p.length}/${g.length}`,p.map(s=>`${s.name} (${s.type})`));const A=p.reduce((s,R)=>{const w=R.type||"unknown";return s[w]=(s[w]||0)+1,s},{});console.log("AI image needs by type:",A)}else y([]),b(null),console.log("No results found")}catch(c){console.error("Search error:",c),h(c.message)}finally{f(!1)}};return x.useEffect(()=>{console.log("useEffect triggered, query:",a,"category:",l),a&&v(a,l)},[a,l]),e.jsxs("div",{className:`min-h-screen ${t==="dark"?"bg-gray-900 text-white":"bg-gray-50 text-gray-900"}`,children:[e.jsx("div",{className:`${t==="dark"?"bg-gray-800":"bg-white"} shadow-lg p-4`,children:e.jsxs("div",{className:"max-w-7xl mx-auto",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("button",{onClick:()=>u(-1),className:"flex items-center gap-2 px-4 py-2 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors",children:[e.jsx(P,{}),"Back"]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(k,{className:"text-blue-500 text-xl"}),e.jsx("h1",{className:"text-2xl font-bold",children:"Search Results"}),a&&e.jsxs("span",{className:"text-lg text-gray-500",children:['for "',a,'"']}),l!=="all"&&e.jsx("span",{className:"px-3 py-1 bg-gradient-to-r from-teal-500 to-cyan-600 text-white text-sm rounded-full font-medium",children:l==="hotel"?"ðŸ¨ Hotels":l==="place"?"ðŸ—ºï¸ Places":l==="restaurant"?"ðŸ´ Restaurants":"ðŸŒ All"})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("div",{className:"text-sm text-gray-500",children:"Unlimited Search"}),e.jsx("div",{className:"text-xs text-green-600",children:"All matching results shown"})]})]}),r&&e.jsxs("div",{className:"flex items-center justify-between text-sm text-gray-600 dark:text-gray-400 bg-blue-50 dark:bg-blue-900/20 p-3 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("span",{children:["Found ",e.jsx("span",{className:"font-bold text-blue-600 text-lg",children:r.count})," results",r.category!=="all"&&e.jsxs("span",{className:"ml-2 text-xs",children:["in ",r.category==="hotel"?"Hotels":r.category==="place"?"Places":r.category==="restaurant"?"Restaurants":"All Categories"]})]}),r.unlimited&&e.jsx("span",{className:"px-2 py-1 bg-green-100 dark:bg-green-900 text-green-800 dark:text-green-200 text-xs rounded-full font-medium",children:"âœ“ All Results Shown"})]}),e.jsx("div",{className:"text-xs",children:"Sorted by relevance â€¢ No limits applied"})]})]})}),e.jsx("div",{className:"max-w-7xl mx-auto p-6",children:S?e.jsx("div",{className:"flex items-center justify-center py-20",children:e.jsxs("div",{className:"text-center",children:[e.jsx(C,{className:"text-5xl text-blue-500 animate-spin mx-auto mb-6"}),e.jsx("p",{className:"text-xl",children:"Searching through all destinations..."}),e.jsxs("p",{className:"text-sm text-gray-500 mt-2",children:['Finding every match for "',a,'"']})]})}):j?e.jsxs("div",{className:"text-center py-20",children:[e.jsxs("p",{className:"text-red-500 text-xl mb-4",children:["Error: ",j]}),e.jsx("button",{onClick:()=>v(a,l),className:"px-6 py-3 bg-blue-500 text-white rounded-lg hover:bg-blue-600 transition-colors",children:"Try Again"})]}):d.length===0?e.jsxs("div",{className:"text-center py-20",children:[e.jsx(k,{className:"text-6xl text-gray-400 mx-auto mb-4"}),e.jsxs("p",{className:"text-2xl mb-4",children:['No results found for "',a,'"']}),e.jsx("p",{className:"text-gray-500",children:"Try a different search term or check your spelling"})]}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6",children:d.map((n,o)=>e.jsx(E,{item:n,index:o,theme:t,navigate:u},o))}),e.jsxs("div",{className:"mt-12 text-center p-6 bg-gray-100 dark:bg-gray-800 rounded-lg",children:[e.jsx("h3",{className:"text-lg font-bold mb-2",children:"Search Complete"}),e.jsxs("p",{className:"text-gray-600 dark:text-gray-400",children:["Showing all ",e.jsx("span",{className:"font-bold text-blue-600",children:d.length}),' results matching "',a,'" â€¢ No results hidden or limited']})]})]})})]})}const E=({item:t,index:u,theme:m,navigate:d})=>e.jsxs("div",{className:`group p-6 rounded-xl border ${m==="dark"?"bg-gray-800 border-gray-700 hover:border-gray-600":"bg-white border-gray-200 hover:border-gray-300"} hover:shadow-xl transition-all duration-300 cursor-pointer transform hover:-translate-y-1 relative`,onClick:()=>d(`/details?type=${t.type}&name=${encodeURIComponent(t.name)}`),children:[t.relevance_score&&e.jsxs("div",{className:"absolute top-3 right-3 bg-gradient-to-r from-blue-500 to-purple-600 text-white text-xs px-3 py-1 rounded-full font-bold shadow-lg z-10",children:[t.relevance_score,"% match"]}),e.jsx("div",{className:"relative w-full h-48 mb-4 rounded-lg overflow-hidden",children:e.jsx(F,{item:t,className:"w-full h-full object-cover transition-all duration-300 group-hover:scale-105",style:{width:"100%",height:"100%"},showLoader:!0,eager:!0})}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("h3",{className:"text-lg font-bold line-clamp-2 group-hover:text-blue-600 transition-colors",children:t.name}),e.jsxs("div",{className:"flex items-center gap-2 text-sm text-gray-600 dark:text-gray-400",children:[e.jsx(q,{className:"text-red-500 flex-shrink-0"}),e.jsx("span",{className:"line-clamp-1",children:t.location})]}),e.jsx("p",{className:"text-sm line-clamp-3 text-gray-700 dark:text-gray-300 leading-relaxed",children:t.description||"Discover this amazing destination in Nepal."}),e.jsxs("div",{className:"flex items-center justify-between pt-2",children:[t.type&&e.jsx("span",{className:"px-3 py-1 bg-blue-100 dark:bg-blue-900 text-blue-800 dark:text-blue-200 text-xs rounded-full font-medium",children:t.type.replace(/_/g," ")}),t.province&&e.jsxs("span",{className:"text-xs text-gray-500 font-medium",children:["Province ",t.province]})]})]})]});export{T as default};
